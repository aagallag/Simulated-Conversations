{% extends "admin/base_site.html" %}
{% load staticfiles %}

{% block title %}
Admin | Template Wizard
{% endblock %}
{% block branding %}
<h1 id="site-name">Simcon administration | Template Wizard</h1>
{% endblock %}

{% block extrahead %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Created for Simulated Conversations Senior Capstone Project">
    <meta name="author" content="Nathanial Myers, Nick Horner">

    <!-- Bootstrap core CSS -->
    <link href="{% static "dist/css/bootstrap.css" %}" rel="stylesheet">

    <!-- prevent line breaks when using form fields -->
    <style type="text/css">
    form {display:inline; margin:0px; padding:0px;}
    </style>

    <!-- jQuery addition -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.js"></script>


    <script>

    $(document).ready(function(){      
    <!-- the snippet below ensures the AJAX POST has a CSRF token for django -->
      $(document).ajaxSend(function(event, xhr, settings) {
	  function getCookie(name) {
	      var cookieValue = null;
	      if (document.cookie && document.cookie != '') {
		  var cookies = document.cookie.split(';');
		  for (var i = 0; i < cookies.length; i++) {
		      var cookie = jQuery.trim(cookies[i]);
		      // Does this cookie string begin with the name we want?
		      if (cookie.substring(0, name.length + 1) == (name + '=')) {
			  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
			  break;
		      }
		  }
	      }
	      return cookieValue;
	  }
	  function sameOrigin(url) {
	      // url could be relative or scheme relative or absolute
	      var host = document.location.host; // host + port
	      var protocol = document.location.protocol;
	      var sr_origin = '//' + host;
	      var origin = protocol + sr_origin;
	      // Allow absolute or scheme relative URLs to same origin
	      return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
		  (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
		  // or any other URL that isn't scheme relative or absolute i.e relative.
		  !(/^(\/\/|http:|https:).*/.test(url));
	  }
	  function safeMethod(method) {
	      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
	  }

	  if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
	      xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
	  }
      });
      <!-- end snippet -->
      
      <!-- here's the ajax/jquery code to remove a video from pool-->
      $("#leftPane").on("click", "button.removeVideoButton", function(){
           var removeVideoFromPool = $(this).val();
           var data = { removeVideoFromPool:removeVideoFromPool };
           var args = { type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                           $("#leftPane").load("/admin/template-wizard-left-pane")
                           <!-- check if its the video to be deleted, and load the empty right pane if so -->
                           $("#rightPane").load("/admin/template-wizard-right-pane")
                       } };
           $.ajax(args);
      });
      <!-- here's the code to add a video to the pool -->
      $("#leftPane").on("click", "button.addVideoButton", function(){
           var new_video = $("#video_name").val();
           var data = { new_video:new_video };
           var args = { type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                            $("#leftPane").load("/admin/template-wizard-left-pane")
                       } };
           $.ajax(args);
      });
      <!-- select a video to edit the video/response page (by clicking button)-->
      $("#leftPane").on("click", "button.editVideoButton", function(){
          var editVideo = $(this).val();
          var data = { editVideo:editVideo };
          var args = {type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                            <!-- TODO before loading right pane, check if there is data there, and save it if so -->
                            $("#rightPane").load("/admin/template-wizard-right-pane")
                     }};
          $.ajax(args);
      });
      <!-- show instructions near top of page-->
      $("#instrucLink").on("click", "#showInstruc", function(){
          $("#instrucLink").html('<br><br><button type=button class="btn btn-default btn-xs" id=hideInstruc> Hide Instructions </button>')
          $("#instructions").html(
            '<div class="alert alert-success">'+
              'Heres how to use this page.... blah blah blah.'+
            '</div>')
      });
      <!-- hide instructions near top of page-->
      $("#instrucLink").on("click", "#hideInstruc", function(){
          $("#instrucLink").html('<br><br><button type=button class="btn btn-default btn-xs" id=showInstruc> Show Instructions </button>')
          $("#instructions").html(' ')
      });
      <!-- this function is called to save the video editor page -->
      var saveVideoPage = function(){
         var data = new Array();
         data['enablePlayback'] = $("#enablePlayback").val();
         for (res in $("$responses .response")){
            data['response'][res] = $(this)[res].val();
         }
         var args = {type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                            <!-- this isnt finished... -->
                            $("#rightPane").load("/admin/template-wizard-right-pane")
                     }};
          $.ajax(args);

      }
      <!-- add a response option on the video editor page -->
      $("#rightPane").on("click", "#addResponseButton", function(){
        if($("#addResponseChildVideo").val() != "none" && $("#addResponseText").val() != ""){
           var addResponseText = $("#addResponseText").val();
           var addResponseParentVideo = $("#addResponseParentVideo").val();
           var addResponseChildVideo = $("#addResponseChildVideo").val();
           var addResponse = "submit"; <!-- a placehold to signify in the view what action to take -->
           var data = { addResponse:addResponse, addResponseText:addResponseText, addResponseParentVideo:addResponseParentVideo, addResponseChildVideo:addResponseChildVideo };
           var args = { type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                           $("#rightPane").load("/admin/template-wizard-right-pane")
                       } };
           $.ajax(args);
        }
      });

      $("#rightPane").on("click", "#removeResponseButton", function(){
          var removeResponseId = $(this).val();
          alert("removing button: " + removeResponseId);
          var removeResponse = "removeResponse";
          var data = { removeResponse:removeResponse, removeResponseId:removeResponseId };
          var args = {type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                            <!-- TODO before loading right pane, check if there is data there, and save it if so -->
                            $("#rightPane").load("/admin/template-wizard-right-pane")
                     }};
          $.ajax(args);
      });
      <!-- save video page -->
      $("#rightPane").on("click", "#saveVideoPage", function(){
           var saveVideoPage = $("#saveVideoPage").val();
           var data = { saveVideoPage:saveVideoPage };
           var args = { type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                           $("#rightPane").load("/admin/template-wizard-right-pane")
                       } };
           $.ajax(args);
      });
      <!-- enable/disable playback -->
      $("#rightPane").on("click", "#enablePlayback", function(){
           var enablePlayback = "off";
           if ($("#enablePlayback").is(":checked"))
                enablePlayback = "on";
           //var enablePlayback = $("#enablePlayback").val();
           var vid = $("#selectedVideo").val();
           var data = { enablePlayback:enablePlayback, vid:vid };
           var args = { type:"POST", url:"/admin/template-wizard-update", data:data, cache:false, complete:function(){
                           $("#rightPane").load("/admin/template-wizard-right-pane")
                       } };
           $.ajax(args);
      });
      <!-- save the whole template -->
      $("#templateSaver").on("click", "#saveTemplateButton", function(){
           var convoTitle = $("#conversationTitle").val();
           var data = { saveTemplateButton:"saveTemplateButton", conversationTitle: convoTitle };
           var args = { type:"POST", url:"/admin/template-wizard", data:data, cache:false, complete:function(){
                           <!--load submit page-->
                           alert("probably successfully saved template!");
                           $("body").load("/admin/template-wizard")
                       } };
           $.ajax(args);
      });
    });
    </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- tinymce -->
    
    {% endblock %}

  {% block content %}

    <div id="mainBody" class="container">
      <div class="starter-template">
        <div class="row">
          <div class="col-md-7">
            <h2>Conversation Template Wizard</h2>
          </div>
          <div class="col-md-2" id="instrucLink">
            <br><br><button type="button" class="btn btn-default btn-xs" id="showInstruc"> Show Instructions </button>
          </div>
          <div class="col-md-3" id="templateSaver">
            <br><button type="button" id="saveTemplateButton" class="btn btn-default btn-lg">Save Template &raquo; </button>
          </div>
        </div>
          <div id="instructions"></div>
          <div class="form-group">
          <label for="conversationTitle">Conversation Title</label>
          <input type="text" id="conversationTitle" class="form-control" placeholder="Enter a title">
          </div>
          <div class="row">
            <div class="col-md-4">
              <h4><u>Videos</u></h4>
              <div id="leftPane">
                {% include "admin/template-wizard-left-pane.html" %}
              </div>
            </div>
            <div class="col-md-8">
              <div class="panel panel-default">
                <div class="panel-heading videoEditorTitle" id="videoEditorTitle">
                  <h3 class="panel-title">Video Page Editor</h3>
                </div>
                <div class="panel-body">
                  <div id="rightPane">
		    {%  include "admin/template-wizard-right-pane.html" %}
                  </div>                  
                </div>
              </div>
            </div>
          </div>
          <hr>
        <!--/form-->

      </div>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{% static "dist/js/bootstrap.min.js" %}"></script>
{% endblock %}
