{% extends "Student_Base.html" %}

{% load staticfiles %}

{# for recorder functions #}
{% load recorder_tags %}

{% block title %}Student Video Response{% endblock %}

{% block extrahead %}
{% getRecorderHead %}

{% endblock %}

{% block content %}
        <div class="alert alert-success">Here's how to use this page.... blah blah blah.</div>
        <h3>Video Page</h3>
	    {% if playback == True %}
          <p><iframe title="YouTube video player" class="youtube-player" type="text/html" 
              width="640" height="390" src="http://www.youtube.com/embed/{{vidLink}}"
              frameborder="0" allowFullScreen></iframe></p>
        {% else %}
          <p><iframe title="YouTube video player" class="youtube-player" type="text/html" 
              width="640" height="390" src="http://www.youtube.com/embed/{{vidLink}}" showsearch=0 rel = 0
              frameborder="0" allowFullScreen></iframe></p>
        {% endif %}
        <div class="well well-sm">{{text|safe}}</div>

<!-->because I can't record audio, I need this button to move through the conversation. this might be affecting my affecting my testing</-->
		<form name="input" action="/studentconvostep/" method="post">{%csrf_token%}
		  <input type="submit" class="btn btn-default" value="Record Audio">
		</form>

        {% load_getUserMedia "makeRecording" %}
        {# defaultHandler "makeRecording" #}  
        <button class="btn btn-default btn-lg" onclick="startRecording(this);"><span class="glyphicon glyphicon-record"/>Record</button>
        <button class="btn btn-default btn-lg" onclick="stopRecording(this);" disabled><span class="glyphicon glyphicon-stop"\>Stop</button>
        <script type="text/javascript">
        function makeRecording(blob){
            window.savedAudio = blob;
            saveRecording(blob);
        }
        function saveRecording(blob){
               var fd = new FormData();  // needed to wrap the blob
               fd.append('data', blob);
               var data = { recording:blob };
               var args = { type:"POST", url:"{% url "SaveAudio" %}", data:fd, processData: false, contentType: false, cache:false, complete:function(){
                               gotoNext()
                           } };
               $.ajax(args);
        }
        function gotoNext(){
           //var fd = new FormData();  // needed to wrap the blob
           //fd.append('data', window.savedAudio);
           //var data = { recording:blob };
           var data = {'VoR': 'video'};
           var args = { type:"POST", url:{% url 'StudentConvoStep' %}, data:data, processData: false, contentType: false, cache:false, complete:function(){
                           window.location.replace("{% url 'text_response' %}");
                       } };
           $.ajax(args);
        }
        </script>
{% endblock %}
